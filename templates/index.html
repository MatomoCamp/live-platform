<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MatomoCamp Livestream -- {{ talk.title }}</title>
    {% if debug and False %}
        <link href="/css" rel="stylesheet">
    {% else %}
        <link href="/static/main.css" rel="stylesheet">
    {% endif %}
    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        _paq.push(['enableHeartBeatTimer']);
        (function () {
            var u = "//mtm.matomocamp.org/";
            _paq.push(['setTrackerUrl', u + 'matomo.php']);
            _paq.push(['setSiteId', '5']);
            var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
            g.async = true;
            g.src = u + 'matomo.js';
            s.parentNode.insertBefore(g, s);
        })();
    </script>
    <!-- End Matomo Code -->
</head>
<body>
<nav class="navbar navbar-light navbar-dark">
    <button id="side-by-side-button" class="btn" data-bs-toggle="tooltip" data-bs-placement="bottom"
            title="Change Layout">
        Side-by-Side view
    </button>
    <a href="https://matomocamp.org">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 718.8 89.4" xml:space="preserve">
            <path d="M403.5 11.8a29 29 0 1 0 0 58 29 29 0 0 0 0-58zm0 43.5a14.5 14.5 0 1 1 0-29 14.5 14.5 0 0 1 0 29zM250.3 11.8a29 29 0 1 0 0 58 29 29 0 0 0 0-58zm0 43.5a14.5 14.5 0 1 1 0-29 14.5 14.5 0 0 1 0 29zm-33.9-10.5a7.3 7.3 0 0 0-14.5 0 10.6 10.6 0 0 1-21 0V26.3h17a7.3 7.3 0 1 0 0-14.5h-17.1V6.9a7.2 7.2 0 0 0-14.4 0v5h-6a7.2 7.2 0 1 0 0 14.4h5.9v18.5a25 25 0 0 0 50 0m153.3 17.7v-26a25 25 0 0 0-42.7-17.1 24.9 24.9 0 0 0-42.7 17.1v26a7.2 7.2 0 0 0 14.4 0V36.8a10.6 10.6 0 0 1 21.1 0v25.4c0 4 3.3 7.4 7.3 7.5 4-.1 7.1-3.5 7-7.4V36.8a10.6 10.6 0 0 1 21.1 0v25.7a7.2 7.2 0 1 0 14.4 0m-284.1 0v-26a25 25 0 0 0-42.8-17.1A24.9 24.9 0 0 0 0 36.5v26a7.2 7.2 0 1 0 14.4 0V36.8a10.6 10.6 0 1 1 21.2 0v25.4c0 4 3.2 7.4 7.3 7.5 4-.2 7-3.5 7-7.5V36.8a10.6 10.6 0 0 1 21 0v25.7a7.3 7.3 0 1 0 14.5 0m391.9 6.9a30 30 0 0 1-20.7-8.2 28.4 28.4 0 0 1-6.3-31.5 29.3 29.3 0 0 1 46.7-9.9c.9.9 1.5 1.8 2 2.8.4 1 .7 2.1.7 3.1a6.5 6.5 0 0 1-2.3 5.2 8 8 0 0 1-3.4 2l-1.6.2-1.4-.2a9 9 0 0 1-2.8-1.3l-2.6-1.8a15 15 0 0 0-5-2.5 15 15 0 0 0-4.8-.6 12 12 0 0 0-5.2 1.5 15.4 15.4 0 0 0-7 7.6 12.3 12.3 0 0 0 0 9.8 16.2 16.2 0 0 0 7 7.7 11.4 11.4 0 0 0 6 1.5c1.4 0 2.8-.2 4-.6a15 15 0 0 0 5-2.7 55 55 0 0 1 2.6-1.8c.8-.6 1.8-1 2.7-1.2l1.4-.1a7.2 7.2 0 0 1 5.1 2.1 6.3 6.3 0 0 1 2.3 5.2 8.7 8.7 0 0 1-2.7 5.9 25.8 25.8 0 0 1-8.9 5.7 28 28 0 0 1-10.8 2zm191.8 20a7.4 7.4 0 0 1-6.8-4.6 8 8 0 0 1-.6-3v-41a27.6 27.6 0 0 1 8.4-20.2 29.2 29.2 0 0 1 20.2-8.4 27.5 27.5 0 0 1 20.1 8.4 29.5 29.5 0 0 1 8.4 20.2 29.4 29.4 0 0 1-17.4 26.3 27.8 27.8 0 0 1-24.1-.9l-1-.5v16c0 1.2-.2 2.2-.6 3.1a6.8 6.8 0 0 1-6.6 4.6zm21.3-62.6a13.6 13.6 0 0 0-9.9 4 14.5 14.5 0 0 0-3 4.5 13.5 13.5 0 0 0 0 11 14.7 14.7 0 0 0 7.5 7.4 13.6 13.6 0 0 0 10.8 0 13.8 13.8 0 0 0 7.4-7.4 13.8 13.8 0 0 0 0-11 14 14 0 0 0-12.9-8.6zm-542 35.4V19.4a7 7 0 0 0-6.6-7.6h-.8a6.9 6.9 0 0 0-6.6 4.3 29 29 0 1 0 0 49.4 6.9 6.9 0 0 0 6.6 4.3 7 7 0 0 0 7.3-7.6zm-14.6-20.1a14.5 14.5 0 1 1 0-2.6zm520.8 20.4v-26a25 25 0 0 0-42.7-17.1 24.9 24.9 0 0 0-42.7 17.1v26a7.2 7.2 0 0 0 14.4 0V36.8a10.6 10.6 0 0 1 21.1 0v25.4c0 4 3.2 7.4 7.3 7.5 4-.1 7-3.5 7-7.4V36.8a10.6 10.6 0 0 1 21.1 0v25.7a7.2 7.2 0 1 0 14.4 0m-92.1-.3V19.4a7 7 0 0 0-6.4-7.6h-.8a6.9 6.9 0 0 0-6.6 4.3 29 29 0 1 0 0 49.4 6.9 6.9 0 0 0 6.6 4.3 7 7 0 0 0 7.3-6.9v-.7zM548 42.1a14.5 14.5 0 1 1 0-2.6z"/>
        </svg>
    </a>
    <a href="{{ talk.chat_room_url}}" class="btn" data-bs-toggle="tooltip"
       data-bs-placement="bottom" title="Open Chat in new tab" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat"
             viewBox="0 0 16 16">
            <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
        </svg>
    </a>
</nav>
<div id="description" class="container">
    <h1>
        {{ talk.title }}
        <span class="badge rounded-pill bg-primary">{{ talk.room }}</span>
    </h1>
    <p>
        by {{ talk.speaker_names|join(", ") }}
        <span class="badge rounded-pill" style="background: {{ talk.track_color }}">{{ talk.track }}</span>
    </p>
    <dl>
        <dt>Language</dt>
        <dd>{{ talk.full_language }}</dd>
        <dt>Starts</dt>
        <dd>{{ delta }}</dd>
        <dt>Chat Room</dt>
        <dd><a target="_blank" href="{{ talk.chat_room_url }}"><code>{{ talk.chat_room_id }}</code></a></dd>
    </dl>
    <p>{{ talk.abstract }}</p>

    {% macro talk_item(t) -%}
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
               aria-expanded="false">{{ t.title }}</a>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{{ url_for("talk_page",session_id=t.id) }}">{{ t.room }}</a></li>
                <li><a class="dropdown-item" href="{{ t.schedule_url }}">Details</a></li>
                <li><a class="dropdown-item" href="{{ t.chat_room_url }}">Chat-Room</a></li>
            </ul>
        </li>
    {%- endmacro %}


    <h3>At the same time</h3>
    <ul class="nav flex-column">
        {% for other_talk in others %}
            {{ talk_item(other_talk) }}
        {% endfor %}
    </ul>
    {% if next %}
        <h3>Coming up next</h3>
        <ul class="nav flex-column">
        {% for other_talk in next %}
            {{ talk_item(other_talk) }}
        {% endfor %}
    {% endif %}
    </ul>
</div>
<div id="video-wrapper">
    <video-js id="vid1" controls class="vjs-16-9"
              poster="https://matomocamp.org/wp-content/uploads/2021/05/matomo-camp.png">
        <source
                src="{{ talk.livestream_url }}"
                type="application/x-mpegURL">
    </video-js>
</div>
<div class="ratio ratio-16x9" id="chat-wrapper">
    <iframe id="iframe" src="{{ talk.chat_room_url }}"></iframe>
</div>
<!--<button id="livestream1">Livestream 1</button>-->
<!--<button id="livestream2">Livestream 2</button>-->
<script src="/static/libs/video.min.js"></script>
<script src="/static/libs/videojs-contrib-quality-levels.min.js"></script>
<script src="/static/libs/videojs-hls-quality-selector.min.js"></script>
<script src="/static/libs/bootstrap.bundle.min.js"></script>
<script>
    window.scrollTo = function () {
    };
    document.getElementById("iframe").addEventListener("load", function () {
        document.body.focus()
    })
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

    window.HELP_IMPROVE_VIDEOJS = false
    let liveui = !videojs.browser.IS_ANDROID
    const vid = document.getElementById('vid1');
    const player = videojs(vid, {
        liveui: liveui,
        liveTracker: {
            trackingThreshold: 0,
        },
        aspectRatio: '16:9'
    });
    player.play();
    let qualityLevels = player.qualityLevels();
    qualityLevels.on('addqualitylevel', function (event) {
        let qualityLevel = event.qualityLevel;
        console.info(qualityLevel)
    });
    player.hlsQualitySelector();
    // document.getElementById("livestream2").addEventListener("click", function () {
    // player.src("https://stream-mtmc-2021.cloud-ed.fr/hls/stream2.m3u8")
    // })
    // document.getElementById("livestream1").addEventListener("click", function () {
    // player.src("https://stream-mtmc-2021.cloud-ed.fr/hls/stream.m3u8")
    // })
    const displayModeNames = {"regular": "Regular", "side-by-side": "Side-by-side View", "no-chat": "Hidden Chat"}
    const chatWrapper = document.getElementById("chat-wrapper")

    function setDisplayMode() {
        document.body.className = displayMode
        localStorage.setItem("displayMode", displayMode)
        if (displayMode === "no-chat") {
            document.querySelector("iframe").remove()
        } else if (!document.querySelector("iframe")) {
            window.location.reload()
        }
        if (displayMode === "side-by-side") {
            chatWrapper.classList.remove("ratio")
        } else {
            chatWrapper.classList.add("ratio")

        }
        document.getElementById("side-by-side-button").innerText = displayModeNames[displayMode]
    }


    const stored = localStorage.getItem("displayMode")
    let displayMode;
    if (stored) {
        displayMode = stored
    } else {
        displayMode = "regular"
    }
    setDisplayMode()
    document.getElementById("side-by-side-button").addEventListener("click", function () {
        switch (displayMode) {
            case "regular":
                displayMode = "side-by-side"
                break
            case "side-by-side":
                displayMode = "no-chat"
                break
            case "no-chat":
                displayMode = "regular"
                break
        }
        setDisplayMode()
    })
</script>
</body>
</html>
